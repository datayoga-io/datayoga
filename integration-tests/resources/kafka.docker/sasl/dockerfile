# FROM confluentinc/cp-kafka:5.4.3
# ENV KAFKA_OPTS="-Djava.security.auth.login.config=/etc/kafka/kafka_server_jaas.conf"
# ENV KAFKA_INTER_BROKER_LISTENER_NAME=SASL_PLAINTEXT
# ENV KAFKA_SASL_ENABLED_MECHANISMS=PLAIN
# ENV KAFKA_SASL_MECHANISM_INTER_BROKER_PROTOCOL=PLAIN
# ENV KAFKA_LISTENERS="SASL_PLAINTEXT://:9093,BROKER://:9092"
# ENV KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=BROKER:SASL_PLAINTEXT,SASL_PLAINTEXT:SASL_PLAINTEXT
# ENV KAFKA_INTER_BROKER_LISTENER_NAME=BROKER
# ENV KAFKA_BROKER_ID=1
# ENV KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR=1
# ENV KAFKA_OFFSETS_TOPIC_NUM_PARTITIONS=1
# ENV KAFKA_LOG_FLUSH_INTERVAL_MESSAGES=10000000
# ENV KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS=0
# COPY kafka_server_jaas.conf /etc/kafka
# COPY entry.sh /
# ENTRYPOINT ["/entry.sh", "SASL_PLAINTEXT://:9093,BROKER://:9092"]


FROM confluentinc/cp-kafka:latest
ENV KAFKA_OPTS="-Djava.security.auth.login.config=/etc/kafka/kafka_server_jaas.conf"
#ENV KAFKA_ADVERTISED_LISTENERS=SASL_PLAINTEXT://:9093,BROKER://:9092
ENV KAFKA_LISTENERS=SASL_PLAINTEXT://:9093,BROKER://:9092
ENV KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=SASL_PLAINTEXT:SASL_PLAINTEXT,BROKER:PLAINTEXT
ENV KAFKA_INTER_BROKER_LISTENER_NAME=BROKER
ENV KAFKA_SECURITY_INTER_BROKER_PROTOCOL=PLAINTEXT
ENV KAFKA_SASL_ENABLED_MECHANISMS=PLAIN
ENV KAFKA_SASL_MECHANISM_INTER_BROKER_PROTOCOL=PLAIN

ENV KAFKA_SASL_JAAS_CONFIG="org.apache.kafka.common.security.plain.PlainLoginModule required username='admin' password='admin-secret';"
ENV KAFKA_NUM_PARTITIONS=1
ENV KAFKA_DEFAULT_REPLICATION_FACTOR=1
ENV KAFKA_BROKER_ID=1
COPY kafka_server_jaas.conf /etc/kafka
COPY entry.sh /
ENTRYPOINT ["/entry.sh", "SASL_PLAINTEXT://:9093,BROKER://:9092"]

#FROM confluentinc/cp-schema-registry:5.5.3
#ENV SCHEMA_REGISTRY_HOST_NAME=schema-registry
#ENV SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS="localhost:9092;:9091"
#ENV SCHEMA_REGISTRY_KAFKASTORE_SECURITY_PROTOCOL=SASL_SSL
#ENV SCHEMA_REGISTRY_KAFKASTORE_SASL_MECHANISM=PLAIN
#ENV SCHEMA_REGISTRY_KAFKASTORE_SASL_JAAS_CONFIG='org.apache.kafka.common.security.plain.PlainLoginModule required username="admin" password="admin-secret";'
