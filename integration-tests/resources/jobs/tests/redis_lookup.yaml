input:
  uses: files.read_csv
  with:
    file: lookup.csv
    batch_size: 1
steps:
  - uses: redis.lookup
    with:
      connection: cache
      command:
        elements:
          - json_parse(cmd1)
          - lfield
          - json_parse(cmd2)
        language: jmespath
      field: obj
  - uses: map
    with:
      expression:
        id: id
        lfield: lfield
        obj: concat([obj])
      language: jmespath
  - uses: redis.write
    with:
      connection: cache
      command: HSET
      key:
        expression: id
        language: jmespath
